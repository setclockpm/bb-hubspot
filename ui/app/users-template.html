<div class="container" ng-cloak>
    <div ng-show="isReady">
        <div class="page-header">
            <h1>Hubspot Integration via SKY API</h1>
        </div>

        <!--
          LOGIN
            This section is hidden if the session has NOT been authenticated.
        -->
        <div ng-if="!isAuthenticated">
            <div class="well">
                <h4 class="well-title">Applications implementing the authorization code flow may be authorized in one of
                    two ways:</h4>
                <div class="row">

                    <!--
                      LOGIN with redirect
                        This option redirects the entire page to the Blackbaud Authorization site.
                        The user can then authorize the content, and on success will be redirected back to the main page.
                    -->
                    <div class="col-sm-6">
                        <div class="panel panel-default panel-body">
                            <p>
                                <a href="/auth/login" class="btn btn-primary btn-block btn-lg">
                                    <i class="fa fa-external-link"></i> Authorize using redirect
                                </a>
                            </p>
                            <p>
                                The user authorizes the application after being redirected to the Blackbaud
                                Authorization website.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--
          USERS DATA
            This section is only visible when the session has been authenticated and
            appropriate user data has been returned.
            AngularJS uses a templating engine similar to HandlebarsJS to output model data.
        -->
        <div ng-if="isAuthenticated">
            <div class="well">
                <h3 class="well-title">{{pageTitle}}</h3>
                <p>
                    Uses the <a href="https://developer.blackbaud.com/skyapi/apis/school" target="_blank">School</a>
                    endpoint reference within the Blackbaud SKY API.
                </p>
            </div>
            <div class="table-responsive" ng-if="users">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>BlackBaud Profile URL</th>
                            <th>Relationships</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="user in users">
                            <td>{{ user.id }}</td>
                            <td>
                                <a href="#/users/{{user.id}}">{{ user.first_name + ' ' + user.last_name}} </a>
                            </td>
                            <td>{{ user.email }}</td>
                            <td><a href="{{user.profile_url}}" target="_blank">{{ user.profile_url }}</a></td>
                            <td>Relationships: {{ user.relationships.length }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-responsive" ng-if="user">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th colspan="2">{{ user.email }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Active?</td>
                            <td>{{ user.email_active }}</a></td>
                        </tr>
                        <tr>
                            <td>ID</td>
                            <td>{{ user.id }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <a href="/auth/logout" class="btn btn-primary">Logout</a>
        </div>
    </div>
    <div class="lead" ng-hide="isReady">Loading...</div>
</div>
